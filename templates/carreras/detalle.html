{% extends "base.html" %}

{% block title %}{{ carrera.nombre }} - Racing World{% endblock %}

{% block content %}
<div class="detalle-carrera fade-in">
    <div class="detalle-header">
        <h1>{{ carrera.nombre }}</h1>
        <p class="pais">ğŸ“ {{ carrera.pais }}</p>
        <div class="badge-group mt-2">
            <span class="badge badge-primary">{{ carrera.categoria }}</span>
            <span class="badge badge-info">{{ carrera.fecha }}</span>
            {% if valoracion_promedio > 0 %}
            <span class="badge badge-success">â­ {{ valoracion_promedio }}/5</span>
            {% endif %}
        </div>
        
        <!-- Etiquetas -->
        {% if tags %}
        <div class="mt-3">
            <strong>Etiquetas:</strong>
            {% for tag in tags %}
            <a href="/tags/{{ tag.id }}" class="text-decoration-none">
                <span class="badge" style="background-color: {{ tag.color }}; margin: 2px;">
                    <i class="fas fa-tag"></i> {{ tag.nombre }}
                </span>
            </a>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- BotÃ³n de Favorito -->
        {% if usuario %}
        <form method="post" action="/carreras/{{ carrera.id }}/favorito" class="mt-2">
            <button type="submit" class="btn {% if es_favorito %}btn-danger{% else %}btn-success{% endif %}">
                {% if es_favorito %}ğŸ’” Quitar de Favoritos{% else %}â¤ï¸ Agregar a Favoritos{% endif %}
            </button>
        </form>
        {% endif %}
    </div>

    <div class="detalle-content">
        <!-- InformaciÃ³n General -->
        <div class="detalle-section">
            <h2>ğŸ“‹ InformaciÃ³n General</h2>
            <div class="info-row">
                <span class="info-label">Nombre:</span>
                <span class="info-value">{{ carrera.nombre }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">PaÃ­s:</span>
                <span class="info-value">{{ carrera.pais }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Ciudad:</span>
                <span class="info-value">{{ carrera.ciudad }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Fecha:</span>
                <span class="info-value">{{ carrera.fecha }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">CategorÃ­a:</span>
                <span class="info-value">{{ carrera.categoria }}</span>
            </div>
        </div>

        <!-- Datos del Circuito -->
        <div class="detalle-section">
            <h2>ğŸ Datos del Circuito</h2>
            <div class="info-row">
                <span class="info-label">Longitud:</span>
                <span class="info-value">{{ carrera.longitud_circuito }} km</span>
            </div>
            <div class="info-row">
                <span class="info-label">NÃºmero de vueltas:</span>
                <span class="info-value">{{ carrera.numero_vueltas }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">RÃ©cord de vuelta:</span>
                <span class="info-value">{{ carrera.record_vuelta }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Total de curvas:</span>
                <span class="info-value">{{ carrera.total_curvas }}</span>
            </div>
        </div>

        <!-- DescripciÃ³n -->
        <div class="detalle-section detalle-full-width">
            <h2>ğŸ“– DescripciÃ³n</h2>
            <p>{{ carrera.descripcion }}</p>
        </div>

        <!-- Historia -->
        <div class="detalle-section detalle-full-width">
            <h2>ğŸ“œ Historia</h2>
            <p>{{ carrera.historia }}</p>
            
            <h3>ğŸ† Datos HistÃ³ricos</h3>
            <ul>
                <li>Primera ediciÃ³n: {{ carrera.primera_edicion }}</li>
                <li>CampeÃ³n mÃ¡s exitoso: {{ carrera.campeon_mas_exitoso }}</li>
                <li>Victorias rÃ©cord: {{ carrera.victorias_record }}</li>
                <li>Asistencia rÃ©cord: {{ carrera.asistencia_record }} espectadores</li>
            </ul>
        </div>
    </div>

    <!-- Comentarios y Valoraciones -->
    <div class="detalle-section mt-4">
        <h2>ğŸ’¬ Comentarios y Valoraciones</h2>
        
        {% if usuario %}
        <!-- Formulario para agregar comentario -->
        <div class="comentario-form">
            <h3>âœï¸ Deja tu comentario</h3>
            <form method="post" action="/carreras/{{ carrera.id }}/comentario">
                <div class="form-group">
                    <label for="valoracion">Tu valoraciÃ³n:</label>
                    <select id="valoracion" name="valoracion" required>
                        <option value="5">â­â­â­â­â­ Excelente</option>
                        <option value="4">â­â­â­â­ Muy buena</option>
                        <option value="3">â­â­â­ Buena</option>
                        <option value="2">â­â­ Regular</option>
                        <option value="1">â­ Mala</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="comentario">Tu comentario:</label>
                    <textarea id="comentario" name="comentario" rows="4" required placeholder="Comparte tu experiencia..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Publicar Comentario</button>
            </form>
        </div>
        {% else %}
        <p class="mt-2"><a href="/auth/login">Inicia sesiÃ³n</a> para dejar un comentario.</p>
        {% endif %}

        <!-- Lista de comentarios -->
        <div class="comentarios-lista mt-4">
            <h3>ğŸ“ Comentarios ({{ comentarios|length }})</h3>
            {% if comentarios %}
                {% for comentario in comentarios %}
                <div class="comentario-card mt-3">
                    <div class="comentario-header">
                        <strong>ğŸ‘¤ {{ comentario.username }}</strong>
                        <span class="comentario-valoracion">
                            {% for i in range(comentario.valoracion) %}â­{% endfor %}
                        </span>
                    </div>
                    <p class="comentario-texto">{{ comentario.comentario }}</p>
                    <small class="comentario-fecha">{{ comentario.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
                </div>
                {% endfor %}
            {% else %}
                <p class="mt-2">No hay comentarios aÃºn. Â¡SÃ© el primero en comentar!</p>
            {% endif %}
        </div>
    </div>

    <div class="btn-group mt-4">
        <a href="/carreras" class="btn btn-secondary">â¬…ï¸ Volver a Carreras</a>
        {% if usuario and usuario.is_admin %}
        <a href="/admin/carreras/{{ carrera.id }}/editar" class="btn btn-primary">âœï¸ Editar</a>
        <a href="/admin/carreras/{{ carrera.id }}/eliminar" class="btn btn-danger">ğŸ—‘ï¸ Eliminar</a>
        {% endif %}
    </div>
</div>
{% endblock %}
